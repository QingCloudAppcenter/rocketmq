{
  "name": {{cluster.name}},
  "description": {{cluster.description}},
  "vxnet": {{cluster.vxnet}},
  "multi_zone_policy": "round_robin",
  "advanced_actions": ["change_vxnet", "scale_horizontal"],

  "nodes": [{
    "container": {
      "type": "lxc",
      "zone": "pek3a",
      "image": "img-tkf29bfm"
    },
    "role": "nameserver",
    "count": {{cluster.nameserver.count}},
    "cpu": {{cluster.nameserver.cpu}},
    "memory": {{cluster.nameserver.memory}},
    "instance_class": {{cluster.nameserver.instance_class}},
    "services": {
      "start": {
        "cmd": "/opt/app/bin/ctl.sh restart nameserver"
      },
      "stop": {
        "cmd": "/opt/app/bin/ctl.sh stop nameserver"
      },
      "restart": {
        "cmd": "/opt/app/bin/ctl.sh restart nameserver"
      }
    },
    "health_check": {
      "enable": true,
      "interval_sec": 60,
      "timeout_sec": 10,
      "action_timeout_sec": 30,
      "healthy_threshold": 2,
      "unhealthy_threshold": 2,
      "check_cmd": "/opt/app/bin/ctl.sh check nameserver",
      "action_cmd": "/opt/app/bin/ctl.sh restart nameserver"
    },
    "vertical_scaling_policy": "sequential"
  }, {
    "container": {
      "type": "lxc",
      "zone": "pek3a",
      "image": "img-tkf29bfm"
    },
    "role": "broker",
    "count": {{cluster.broker.count}},
    "cpu": {{cluster.broker.cpu}},
    "memory": {{cluster.broker.memory}},
    "instance_class": {{cluster.broker.instance_class}},
    "volume": {
      "size": {{cluster.broker.volume_size}},
      "mount_point": "/data/broker"
    },
    "replica": {{cluster.broker.replica}},
    "services": {
      "init": {
        "cmd": "/opt/app/bin/ctl.sh init broker"
      },
      "start": {
        "cmd": "/opt/app/bin/ctl.sh restart broker"
      },
      "stop": {
        "cmd": "/opt/app/bin/ctl.sh stop broker"
      },
      "restart": {
        "cmd": "/opt/app/bin/ctl.sh restart broker"
      }
    },
    "health_check": {
      "enable": true,
      "interval_sec": 60,
      "timeout_sec": 10,
      "action_timeout_sec": 30,
      "healthy_threshold": 2,
      "unhealthy_threshold": 2,
      "check_cmd": "/opt/app/bin/ctl.sh check broker",
      "action_cmd": "/opt/app/bin/ctl.sh restart broker"
    },
    "monitor": {
      "enable": true,
      "cmd": "/opt/app/bin/ctl.sh measure broker",
      "items": {
        "putTps": {
          "unit": "",
          "value_type": "int",
          "statistics_type": "latest",
          "scale_factor_when_display": 0.001
        },
        "getTransferedTps": {
          "unit": "",
          "value_type": "int",
          "statistics_type": "latest",
          "scale_factor_when_display": 0.001
        },
        "queryFoundTps": {
          "unit": "",
          "value_type": "int",
          "statistics_type": "latest",
          "scale_factor_when_display": 0.001
        },
        "queryMissTps": {
          "unit": "",
          "value_type": "int",
          "statistics_type": "latest",
          "scale_factor_when_display": 0.001
        },
        "queryTotalTps": {
          "unit": "",
          "value_type": "int",
          "statistics_type": "latest",
          "scale_factor_when_display": 0.001
        },
        "putCountToday": {
          "unit": "",
          "value_type": "int",
          "statistics_type": "latest",
          "scale_factor_when_display": 1
        },
        "getCountToday": {
          "unit": "",
          "value_type": "int",
          "statistics_type": "latest",
          "scale_factor_when_display": 1
        },
        "msgAvgSize": {
          "unit": "Byte",
          "value_type": "int",
          "statistics_type": "latest",
          "scale_factor_when_display": 0.01
        }
      },
      "groups": {
        "msgReqTps": ["putTps", "getTransferedTps", "queryFoundTps", "queryMissTps", "queryTotalTps"],
        "msgCount": ["putCountToday", "getCountToday"]
      },
      "display": ["msgReqTps", "msgCount", "msgAvgSize"],
      "alarm": ["putTps", "getTransferedTps", "queryFoundTps", "queryMissTps", "queryTotalTps"]
    },
    "env": {
      "cluster_name": {{env.broker.cluster_name}},
      "delete_when": {{env.broker.delete_when}},
      "file_reserved_time": {{env.broker.file_reserved_time}},
      "replica_mode": {{env.broker.replica_mode}},
      "flush_disk_type": {{env.broker.flush_disk_type}}
    },
    "vertical_scaling_policy": "sequential"
  }, {
    "container": {
      "type": "kvm",
      "zone": "pek3a",
      "image": "img-tkf29bfm"
    },
    "role": "console",
    "count": {{cluster.console.count}},
    "cpu": {{cluster.console.cpu}},
    "memory": {{cluster.console.memory}},
    "instance_class": {{cluster.console.instance_class}},
    "services": {
      "start": {
        "cmd": "/opt/app/bin/ctl.sh restart console"
      },
      "stop": {
        "cmd": "/opt/app/bin/ctl.sh stop console"
      },
      "restart": {
        "cmd": "/opt/app/bin/ctl.sh restart console"
      }
    },
    "health_check": {
      "enable": true,
      "interval_sec": 60,
      "timeout_sec": 10,
      "action_timeout_sec": 30,
      "healthy_threshold": 2,
      "unhealthy_threshold": 2,
      "check_cmd": "/opt/app/bin/ctl.sh check console",
      "action_cmd": "/opt/app/bin/ctl.sh restart console"
    },
    "env": {
      "user_name": {{env.console.user_name}},
      "user_pwd": {{env.console.user_pwd}}
    },
    "vertical_scaling_policy": "sequential"
  }, {
    "container": {
      "type": "kvm",
      "zone": "pek3a",
      "image": "img-tkf29bfm"
    },
    "role": "client",
    "count": {{cluster.client.count}},
    "cpu": {{cluster.client.cpu}},
    "memory": {{cluster.client.memory}},
    "instance_class": {{cluster.client.instance_class}},
    "user_access": true,
    "services": {
      "init": {
        "cmd": "/opt/app/bin/ctl.sh init client"
      }
    }
  }],

  "display_tabs": {
    "brokerList": {
      "cmd": "/opt/app/bin/ctl.sh readClusterListFrom nameserver",
      "roles_to_execute_on": ["nameserver"],
      "description": "Cluster information - broker names, broker IDs and broker addresses"
    }
  },

  "endpoints": {
    "nameserver": {
      "port": 9876,
      "protocol": "tcp"
    },
    "broker": {
      "port": 10911,
      "protocol": "tcp"
    },
    "brokervip": {
      "port": 10909,
      "protocol": "tcp"
    }
  }
}
